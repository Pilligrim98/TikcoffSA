# Спецификация: Анализ и предложения

## 1. Введение

**Цель:** Провести обзор спецификаций и бизнес-логики для города, выявить возможные проблемы и предложить улучшения.  
**Контекст:** Рассматривается работа с данными городов, включая моделирование базы данных, CRUD-операции и бизнес-ограничения.  

---

## 2. Анализ базовой структуры

### 1. ID города:
- ⚡ **Предложение:** использовать `UUID` вместо `varchar` для унификации и удобной работы с тестовыми базами.
- **Причина:** Это упростит возможное слияние баз данных, исключит риск коллизий и облегчит обслуживание.

### 2. Название и домен:
- ⚡ **Предложение:** определить строгие правила уникальности (учет регистра, латинизации, проверки на схожесть).
- **Причина:** Необходимо учитывать дублирующиеся или схожие записи.

### 3. Географические данные:
- ⚡ **Предложение:** Вынести геоданные в отдельную таблицу для нормализации, интеграции с PostGIS.
- Для координат использовать `PostGIS` (`GEOGRAPHY(Point, 4326)`).
- **Причина:** Это упрощает поддержку географических данных и исключает сложные конверсии.

### 4. Дата создания и удаления:
- **Дата создания:** добавить поле `created_at` с дефолтным значением.
- **Дата удаления:** предусмотреть поведение строк с `null` в колонке `deleted_at` (для мягкого удаления).
- ⚡ **Предложение:** добавить раздел "видимость удаленных объектов" в админке (например, специальное меню для мягко удаленных объектов).  

---

## 3. CRUD: Анализ UseCase’ов

### 1. Общие замечания:
- Сценарии хорошо описаны для "счастливых путей", но отсутствуют альтернативные сценарии.  
- **⚡ Рекомендация:** Указать, что происходит при технических сбоях (недоступность внешних сервисов и пр.).

### 2. Коды ошибок:
- ⚡ **Необходимо добавить:** список ошибок (например, ошибка уникальности — `400`, некорректные координаты — `422`, город не найден — `404`).
- **Причина:** Это обеспечит предсказуемость работы и поддержку API.

### 3. Логика каскадного удаления:
- Как будут обрабатываться зависимые сущности и связанные города при удалении?
- ⚡ **Предложение:** Уточнить каскадность.

### 4. Методы запросов:
- ⚡ **Замечание:** Для удаления используется `POST`. Рекомендую заменить на `DELETE`. Для изменения — на `PATCH`.
- **Причина:** Лучше следовать REST-принципам.

---

## 4. Дополнительные рекомендации

### 1. Документация для UseCase’ов:
- Добавить ключевые элементы:
  - **Акторы:** типы пользователей, которые могут совершать действия с городами.
  - **Цель** каждой операции.
  - **Предусловия:** какие параметры обязательны.
  - **Постусловия:** ожидаемый результат.
  - **Альтернативные сценарии:** (например, ошибка сети или откат действий).

### 2. Платежи:
- Добавить таблицу методов оплаты, связанной с городами (например, `one-to-many`).  
- ⚡ **Причина:** Это упрощает расширение функциональности приложения.

---

## 5. Важные пропущенные элементы

- **Бизнес-ограничения:**
  Ограничения на изменение `domain` или `id`. Если `domain` можно менять, то требуется описать логику переадресации.

- **Сценарии восстановления:**
  Не описана логика восстановления города после "мягкого удаления".

- **API-документация:**
  Привести примеры запросов и ответов (например, через OpenAPI/Swagger).

- **Нефункциональные требования:**
  Требования по производительности, безопасности, масштабируемости.

---

## Вывод

Документ выглядит основательно, однако для улучшения требуется:  
1. Добавить структурированные технические детали (например, коды ошибок, сценарии сбоя).  
2. Уточнить поведение системы при исключительных ситуациях.  
3. Расширить спецификацию за счет разделов "бизнес-ограничения", "восстановление", "ассоциация с сущностями".  

Приведенные изменения улучшат документацию, обеспечив ясность для всех участников разработки.